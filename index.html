<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EMI Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .fade-in {
      animation: fadeIn 0.7s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media print {
      .no-print { display: none; }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md fade-in">
    <h2 class="text-2xl font-bold text-center text-green-700 mb-4">ðŸ“Š EMI Calculator</h2>

    <div class="space-y-3">
      <input type="number" id="amount" placeholder="Loan Amount (â‚¹)" class="w-full p-2 border rounded-md" />
      <input type="number" id="rate" placeholder="Interest Rate (% per annum)" class="w-full p-2 border rounded-md" />
      <input type="number" id="term" placeholder="Loan Term (months)" class="w-full p-2 border rounded-md" />
      <input type="number" id="moratorium" placeholder="Moratorium Period (months)" class="w-full p-2 border rounded-md" />
    </div>

    <button onclick="calculateEMI()" class="mt-4 bg-green-600 hover:bg-green-700 text-white w-full p-3 rounded-md text-lg font-semibold transition">Calculate</button>

    <div id="result" class="mt-6 space-y-2 fade-in hidden">
      <div><strong>Monthly EMI:</strong> â‚¹<span id="emi"></span></div>
      <div><strong>Total Interest:</strong> â‚¹<span id="interest"></span></div>
      <div><strong>Total Payment:</strong> â‚¹<span id="total"></span></div>
    </div>

    <div id="chartSection" class="mt-6 hidden fade-in">
      <h3 class="text-lg font-semibold mb-2">ðŸ“… EMI Payment Schedule</h3>
      <div class="overflow-x-auto max-h-64">
        <table class="min-w-full text-sm border" id="scheduleTable">
          <thead class="bg-gray-200 sticky top-0">
            <tr>
              <th class="border px-2 py-1">Month</th>
              <th class="border px-2 py-1">EMI</th>
              <th class="border px-2 py-1">Interest</th>
              <th class="border px-2 py-1">Principal</th>
              <th class="border px-2 py-1">Balance</th>
            </tr>
          </thead>
          <tbody class="bg-white" id="tableBody"></tbody>
        </table>
      </div>
    </div>

    <button onclick="downloadPDF()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-md font-semibold no-print transition">Download PDF</button>
  </div>

  <script>
    function calculateEMI() {
      const principal = parseFloat(document.getElementById('amount').value);
      const rate = parseFloat(document.getElementById('rate').value);
      const term = parseInt(document.getElementById('term').value);
      const moratorium = parseInt(document.getElementById('moratorium').value);

      if (!principal || !rate || !term || moratorium > term) {
        alert("Please enter valid values.");
        return;
      }

      const monthlyRate = rate / 12 / 100;
      let interestMoratorium = principal * monthlyRate * moratorium;
      let balance = principal + interestMoratorium;
      const effectiveTerm = term - moratorium;
      const emi = (balance * monthlyRate * Math.pow(1 + monthlyRate, effectiveTerm)) / (Math.pow(1 + monthlyRate, effectiveTerm) - 1);
      let totalPayment = 0;
      let totalInterest = interestMoratorium;

      // Update results
      document.getElementById('emi').innerText = emi.toFixed(2);
      document.getElementById('interest').innerText = '...'; // updated after schedule
      document.getElementById('total').innerText = '...';    // updated after schedule
      document.getElementById('result').classList.remove('hidden');

      // Build table
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      let schedule = [];
      for (let i = 1; i <= effectiveTerm; i++) {
        const interestPart = balance * monthlyRate;
        const principalPart = emi - interestPart;
        balance -= principalPart;
        if (balance < 0) balance = 0;
        totalInterest += interestPart;
        totalPayment += emi;

        schedule.push([
          i + moratorium,
          emi.toFixed(2),
          interestPart.toFixed(2),
          principalPart.toFixed(2),
          balance.toFixed(2)
        ]);
      }

      schedule.forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.className = "border px-2 py-1 text-center";
          td.innerText = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      document.getElementById('interest').innerText = totalInterest.toFixed(2);
      document.getElementById('total').innerText = (principal + totalInterest).toFixed(2);
      document.getElementById('chartSection').classList.remove('hidden');
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(14);
      doc.text("EMI Calculator Report", 20, 20);

      doc.setFontSize(10);
      doc.text("Monthly EMI: â‚¹" + document.getElementById('emi').innerText, 20, 30);
      doc.text("Total Interest: â‚¹" + document.getElementById('interest').innerText, 20, 36);
      doc.text("Total Payment: â‚¹" + document.getElementById('total').innerText, 20, 42);

      // Table Header
      const headers = [["Month", "EMI", "Interest", "Principal", "Balance"]];
      const body = Array.from(document.querySelectorAll('#tableBody tr')).map(tr =>
        Array.from(tr.children).map(td => td.innerText)
      );

      doc.autoTable({
        head: headers,
        body: body,
        startY: 50,
        styles: { fontSize: 8 },
      });

      doc.save("emi-calculator.pdf");
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
